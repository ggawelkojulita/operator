## Table of contents
* [Introduction](#introduction)
* [Structure](#structure)
* [How to run this app](#how-to-run-this-app)
* [Backend endpoints - Django](#backend-endpoints---django)
* [Available pages - React](#available-pages---react)
* [Extra](#extra)

## Introduction
Argyle Operator is an admin tool, that allows them to generate landing page with Argyle Link, send email and sms messages to users 
and also display Argyle accounts assigned to user.

## Structure
- `api` - contains Django app files

- `frontend` - contains React app files

- `tools` - contains configuration files (environment settings and Dockerfile)


## How to run this app?

### 1. Set all environment variables
Go to the `tools/env` directory, create a new `.env` file inside, and copy the contents of the `.env.example` file into `.env`. 
Fill in all empty attributes values.

### 2. Set database credentials in the docker-compose.yml file
```  
db:
    image: postgres:13-alpine
    environment:
      POSTGRES_USER: <postgres_user>
      POSTGRES_PASSWORD: <postgress_password>
      POSTGRES_DB: <database_name>
 ```

### 3. Build and run backend app
#### Local
```
cd api
brew install pyenv
brew update
brew upgrade pyenv

pyenv install 3.8.5
pyenv local 3.8.5
pip install --upgrade pip setuptools virtualenv
virtualenv .venv

# activate venv
source ./.venv/bin/activate

# install all requirements
pip install --upgrade pip setuptools
pip install --upgrade -r bkmrk-standalone/requirements.txt

# run backend
python manage.py migrate
python manage.py collectstatic
python manage.py createsuperuser

python manage.py runserver

# run frontend
cd frontend
npm install
npm start
```

#### Docker
```
# build and run project
cd argyle-operator
docker-compose up -d
docker-compose logs -tf

# create admin
docker-compose exec api python manage.py createsuperuser
```

#### Docker + Makefile
```
make build
make run
```

## Backend endpoints - Django
`/admin/*` - Django admin pages \
`/auth/*` - authentication endpoints \
`/users/*` - endpoints for creating/activating/deleting admin users \
`/homepage/*` - endpoints for homepage settings \
`/webhooks/*` - handling information about Argyle account connected by a user link using Argyle Webhooks \
`/generator/*` - responsible for creating new User links, displaying the user list, resending messages, etc. \
`/integrations/*` - endpoints allow setting/displaying Argyle API keys 


## Available pages - React
`/` - Homepage - available for everyone, allows the user to connect with Argyle \
`/<user_token>/` - unique link for specific user (the link is generated by admin on Generator page), allows specific user to link/unlink account with Argyle \
`/admin/login/` - the Admin login page 
`/admin/` - Admin interface with a menu: 
* Admin List (`/admin/accounts/`) - the list of all admins, allows to add a new one or deactivate existing. 
* Homepage (`/admin/homepage/`) - homepage setting, allows admins to change a homepage view 
* API (`/admin/api-keys/`) - set Argyle credentials 
* User Edits (`/admin/user-edits/`) - two forms - invitation email editor and invitation sms editor 
* Generator (`/admin/generator/`) - the form allows to create a new user link with specific data 
* User List (`/admin/user-list/`) - the list of users with opportunity to send email and sms message again, display information about linked accounts and pay allocations 
* Logout (`/admin/logout/`) - logout

### **Important Notes**
1. Until the admin sets the Homepage Settings (`/admin/homepage/`), the Homepage will be blank.
2. Until the admin sets the Argyle API keys (`/admin/api-keys/`), generating user links will be returning error.

## Extra
### Makefile

Run project

```
make / make run
```

Build project

```
make build
```

Stop project

```
make stop
```

Logs

```
make logs
```

Make migrations

```
make makemigrations
```

Migration

```
make migrate
```

Reset db

```
make reset-db
```

CLI

```
make cli
```

Creating new app in apps folder
```
make app app_name=<app_name>
```
